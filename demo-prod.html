<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RTF to HTML Converter</title>
</head>
<body>
  <h1>Upload RTF File</h1>
  <form id="uploadForm">
    <input type="file" id="rtfFile" name="file" accept=".rtf" required />
    <button type="submit">Convert</button>
  </form>

  <h2>Converted HTML Output:</h2>
  <iframe id="htmlFrame" style="width:100%; height:400px; border:1px solid #ccc;"></iframe>

  <script>
    document.getElementById('uploadForm').addEventListener('submit', async function (event) {
      event.preventDefault();

      const fileInput = document.getElementById('rtfFile');
      const file = fileInput.files[0];

      if (!file) {
        alert('Please select a file.');
        return;
      }

      if (file.size > 1024 * 1024) {
        alert("File exceeds 1024 KB limit.");
        return;
      }

      const formData = new FormData();
      formData.append('file', file);

      try {
        const response = await fetch('https://europe-west10-scroogexhtml-11.cloudfunctions.net/rtf-to-html-demo-11/', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.statusText}`);
        }

        const html = await response.text();

        // Write HTML into iframe
        const iframe = document.getElementById('htmlFrame');
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(html);
        iframeDoc.close();

      } catch (error) {
        console.error('Upload failed:', error);
        alert('An error occurred while converting the file.');
      }
    });
  </script>
</body>
</html>
